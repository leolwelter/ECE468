
;str input  "Please enter an integer number: "
;str eol  "\n"

;LABEL   factorial
;LINK   
;STOREI a  $T0
;STOREI 1  $T1
;NE $T0 $T1 label0
;STOREI 1  $T2
;STOREI $T2  $R
;RET   
;JUMP   label1
;LABEL   label0
;STOREI 1  $T3
;STOREI 1  $T4
;NE $T4 $T3 label2
;PUSH   
;PUSH $T4  
;JSR factorial  
;POP   
;POP $T5  
;SUBI $P1 1 $T6
;STOREI $T6  $L2
;MULTI $L2 $P1 $T7
;STOREI $T7  $L1
;JUMP   label1
;LABEL   label1
;LABEL   label2
;STOREI $L1  $T7
;STOREI $T7  $R
;RET   

;LABEL   main
;LINK   
;WRITES input  
;READI $L1  
;STOREI num  $T0
;STOREI 1  $T1
;NE $T0 $T1 label0
;JUMP   label1
;LABEL   label0
;STOREI num  $T1
;STOREI 1  $T2
;LE $T1 $T2 label2
;PUSH   
;PUSH $L1  
;JSR factorial  
;POP   
;POP $T3  
;STOREI   $T3
;STOREI $T3  $L2
;JUMP   label1
;LABEL   label2
;STOREI 1  $T4
;STOREI 1  $T5
;NE $T5 $T4 label3
;JUMP   label1
;LABEL   label1
;LABEL   label3
;WRITEI $L2  
;WRITES eol  
;STOREI 0  $T6
;STOREI $T6  $R
;RET   

str input "Please enter an integer number: "
str eol "\n"
push  
push r0 
push r1 
push r2 
push r3 
jsr main 
sys halt 
label factorial 
link 10 
move a r-1
move 1 r0
cmpi r-1 r0
jne label0 
move 1 r1
move r1 $7
unlnk  
ret  
jmp label1 
label label0 
move 1 r2
move 1 r3
cmpi r3 r2
jne label2 
push  
push r3 
push r0 
push r1 
push r2 
push r3 
jsr factorial 
pop r3 
pop r2 
pop r1 
pop r0 
pop  
pop r4 
move $6 r5
subi 1 r5
move r5 $-2
move $6 r6
muli $6 r6
move r6 $-1
jmp label1 
label label1 
label label2 
move $-1 r6
move r6 $7
unlnk  
ret  
label main 
link 10 
sys writes input
sys readi $-1
move num r-1
move 1 r0
cmpi r-1 r0
jne label0 
jmp label1 
label label0 
move num r0
move 1 r1
cmpi r0 r1
jle label2 
push  
push $-1 
push r0 
push r1 
push r2 
push r3 
jsr factorial 
pop r3 
pop r2 
pop r1 
pop r0 
pop  
pop r2 
move  r2
move r2 $-2
jmp label1 
label label2 
move 1 r3
move 1 r4
cmpi r4 r3
jne label3 
jmp label1 
label label1 
label label3 
sys writei $-2
sys writes eol
move 0 r5
move r5 $6
unlnk  
ret  
sys halt 
